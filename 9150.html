<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>GeoAR.js demo</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
		<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
		<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
		<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
	</head>

	<body style="margin: 0; overflow: hidden;">
		<a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
			<a-entity scale="1 1 1"	gltf-model="./assets/pin_yellow.gltf" gps-entity-place="latitude: 23.021935; longitude: 120.232394;"></a-entity>
			<a-entity scale="1 1 1"	gltf-model="./assets/pin_yellow.gltf" gps-entity-place="latitude: 23.016261; longitude: 120.261303;"></a-entity>
			<a-camera gps-camera rotation-reader> </a-camera>
		</a-scene>

		<script>
			var dataLength = 0;
			var i = 0;
			var name = [], lat = [], lon = [];
			jQuery(document).ready(function(){ 
				$.getJSON( "9177.json", function( data ) {
					dataLength = data.length;
					for(i=0; i<dataLength; i++){//dataLength
						name[i] = data[i].Name;
						lat[i] = data[i].Lat;
						lon[i] = data[i].Long;
						AddEntity(dataLength, data[i].Name, data[i].Lat, data[i].Long);
						console.log("show: " + data[i].Name);//
					};
				});
			});
			//新增與DB資料筆數相符數量的entity, text(包含文字內容)
			function AddEntity(length, name, lat, lon){ //length:新增的數量, data:新增的內容
				//let opacity = 0.5; //(預設開啟)
				//if (showDBdataornot == false){ opacity = 0; };
				//for(let j=0; j<length; j++){
					let newEntity = document.createElement('a-entity');
					newEntity.setAttribute('class','CP');
					newEntity.setAttribute('gltf-model','./assets/pin_yellow.gltf');
					newEntity.setAttribute('gps-entity-place','latitude:'+lat+'; longitude:'+lon+';');
					let reference = document.querySelectorAll('a-entity');
					let referenceNode = reference[reference.length-2];
					document.querySelector('a-scene').insertBefore(newEntity, referenceNode); //確保entity新增在AR.js環境設定entity之前

					let newText = document.createElement('a-text');
					newText.setAttribute('class','CP');
					newText.setAttribute('align', 'center');
					newText.setAttribute('scale', '1.5 1.5 1.5');
					newText.setAttribute('color', 'yellow');
					newText.setAttribute('opacity', '0.8');
					newText.setAttribute('value', name);
					newText.setAttribute('gps-entity-place','latitude:'+lat+'; longitude:'+lon+';');
					newText.setAttribute('look-at', '[gps-camera]');
					console.log("show: " + name);

					document.querySelector('a-scene').insertBefore(newText, referenceNode); //確保新增在AR.js環境設定entity之前
				//}
			}
		</script>
			
	</body>
</html>
